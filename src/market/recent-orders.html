<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<dom-module id="recent-orders" fit>
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment app-grid-style"></style>

        <style include="shared-styles">
            :host {
                display: block;
            }
            paper-progress.green {
                --paper-progress-active-color: var(--paper-light-green-700);
                --paper-progress-secondary-color: var(--paper-light-green-100);
            }
            .container {
                @apply(--layout-horizontal);
                @apply(--layout-center);
            }

        </style>
        <iron-ajax auto url="//raw.githubusercontent.com/Loopring/mock-relay-data/master/orders.json" handle-as="json"
                   last-response="{{resp}}"></iron-ajax>
        <!-- The array is set as the <vaadin-grid>'s "items" property -->
        <vaadin-grid aria-label="Basic Binding Example" items="[[resp.result.data]]">
            <vaadin-grid-column width="50px">
                <template class="header">Time</template>
                <template>[[traTimeStamp(item.orginalOrder.timestamp)]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column width="50px">
                <template class="header">Type</template>
                <template>
                    <div class="horizontal end-justified layout">[[transtoUppercase(item.orginalOrder.tokenS)]]
                        <div class="container"><iron-icon icon="icons:arrow-forward"></iron-icon></div>
                        [[transtoUppercase(item.orginalOrder.tokenB)]]
                    </div>
                </template>
            </vaadin-grid-column>
            <vaadin-grid-column width="50px">
                <template class="header">Amount</template>
                <template>[[numberFormat(item.orginalOrder.amountB)]] [[transtoUppercase(item.orginalOrder.tokenB)]]
                </template>
            </vaadin-grid-column>
            <vaadin-grid-column width="50px">
                <template class="header">Price</template>
                <template>[[getPrice(item.orginalOrder.amountS,item.orginalOrder.amountB)]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column width="50px">
                <template class="header">Size</template>
                <template>[[numberFormat(item.orginalOrder.amountS)]] [[transtoUppercase(item.orginalOrder.tokenS)]]
                </template>
            </vaadin-grid-column>
            <vaadin-grid-column>
                <template class="header">Hash</template>
                <template><a href="#/order"><long-hash hash="[[item.orginalOrder.hash]]"></long-hash></a></template>
            </vaadin-grid-column>

            <vaadin-grid-column width="100px">
                <template class="header" >Completed Percent</template>
                <template>
                    <paper-progress class="green" value="[[numberFormat(item.totalDealedAmountB)]]" max="[[numberFormat(item.orginalOrder.amountB)]]"></paper-progress>
                </template>
            </vaadin-grid-column>
        </vaadin-grid>
    </template>
    <script>
        class RecentOrders extends Polymer.Element {
            static get is() {
                return 'recent-orders';
            }

            static get properties() {
                return {};
            }

            transtoUppercase(str) {
                if (str) {
                    return str.toUpperCase();
                }
                return '';
            }

            tranHextoNum(hex) {
                if (hex) {
                    return Number(hex);
                }
                return 'Error';
            }

            numberFormat(num) {
                const size = this.tranHextoNum(num);
                return (size / 1000000000000000000).toFixed(4);
            }

            getPrice(s, b) {

                const sell = this.numberFormat(s);
                const buy = this.numberFormat(b);
                return (sell / buy).toFixed(8);

            }

            traTimeStamp(ts) {
                const timestamp = this.tranHextoNum(ts)

                if (timestamp) {
                    const date = new Date(ts * 1000);
                    return (
                        date.getFullYear() +
                        '-' +
                        (date.getMonth() < 9
                            ? '0' + (date.getMonth() + 1)
                            : date.getMonth() + 1) +
                        '-' +
                        (date.getDate() < 10 ? '0' + date.getDate() : date.getDate()) +
                        ' ' +
                        (date.getHours() < 10 ? '0' + date.getHours() : date.getHours()) +
                        ':' +
                        (date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes()) +
                        ':' +
                        (date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds())
                    );
                }
                return 'Error';
            }

        }

        window.customElements.define(RecentOrders.is, RecentOrders);
    </script>
</dom-module>